<!--markdown-->
路由表又叫路由选择信息库（RIB）

在数据库中的每个路由表项最少包括下面两个项目：
* **目标地址**
* **指向目标的指针**————指针指向路由器的直连目标网络或直连网络内的另一台路由器地址，或者是到这个链路的本地接口

如果数据包的目的地址不能匹配到任何一条路由表项，那么数据包将被丢弃，同时一个“目标网络不可达”的ICMP消息将会被发送给源地址。

如果把静态路由指向一个广播型出站接口，而不是下一跳地址，路由器会认为该网络是直连网络，当路由器向直连网络内转发数据包时，会触发ARP请求，假如直连网络内存在一台ARP代理，路由器可能会占用大量的ARP缓存。

##### 度量值和管理距离

如果路由器正在运行多个路由选择协议，并从每个协议都学习到一条到达相同目标网络的路由，那么应该选择哪一条路由呢？答案是管理距离。管理距离被看作是一个可信度测度，管理距离越小，协议的可信度越高。

|路由源|管理距离|
|-----|------|
|直连接口|0|
|静态路由|1|
|EIGRP汇总路由|5|
|外部BGP|20|
|EIGRP|90|
|IGRP|100|
|OSPF|110|
|IS-IS|115|
|RIP|120|
|EGP|140|
|外部EIGRP|170|
|内部BGP|200|
|未知|255|

当有多条路径到达相同目标网络时，路由器需要一种机制来计算最优路径，度量（metric）可以按照最好到最坏对路由进行等级划分。

度量值指明了路径（同种路由协议？）的优先权，而管理距离指明了发现路由方式（路由协议）的优先权。

## 动态路由选择协议

### 路由选择协议基础

所有路由选择协议都是围绕一种算法而构建的。通常，一种算法是一个逐步解决问题的过程。一种路由算法至少应指明以下内容：

- 向其他路由器传送网络可达性的过程
- 从其他路由器接收可达性信息的过程
- 基于现有可达性信息决策最优路由的过程以及在路由表中记录这些信息的过程
- 响应、修正和通过网络中拓扑变化的过程

对所有路由选择协议来说，几个共同的问题是路径决策、度量、收敛和负载均衡。

#### 路径决策

路由器需要向其他路由器发送自己的网络信息、选择到达目标网络的最优路径、避免路由环路等。

#### 度量

当有多条路径到达相同目标网络时，路由器需要一种机制来计算最优路径，度量（metric）可以按照最好到最坏对路由进行等级划分。不同的路由协议使用不同的度量。

- 跳数

  跳数度量可以简单地记录路由器跳数。假设仅使用跳数作为度量，那么最优路径就是跳数最少的路径。
  
- 带宽

  带宽度量将会选择高带宽路径，而不是低带宽路径。然而带宽本身可能不是一个好的度量。有时一条空闲的低带宽链路可能比拥堵的高带宽链路更好。
  
- 负载

  负载度量反应了流量占用沿途链路带宽的比重。最优的路径应该是负载最低的路径。路径上的负载会发生变化，因而度量也会跟着变化，如果度量变化过于频繁，路由波动（最优路径频繁变化）可能就发生了。路由波动会对路由器的CPU、数据链路的带宽和全网稳定性产生负面影响。
  
- 时延

  时延（Delay）是度量数据包经过一条路径所花费的时间。时延不仅要考虑链路时延，而且还要考虑路由器的处理时延和队列时延等因素。
  
- 可靠性

  可靠性(Reliability)度量是用来测量链路在某种情况下发生故障的可能性。
  
- 代价

  由管理员设置的代价（Cost）度量可以反应更优或更差路由。

#### 距离失量路由选择协议

路由是以失量（距离、方向）的方式被通告出去的。

- 定期更新

- 广播更新

- 全路由表选择更新

- 依照传闻进行路由选择mus

- 路由失效计时器
    
    路由表中的每个表项设置路由失效计时器，如果经过几个周期没有收到路由更新，把该路由标记为不可达。
    
- 水平分隔

    **简单水平分隔**：从某接口学到的路由不能从该接口发送出去
    
    **毒性逆转水平分隔**：从某接口学到的路由会从该接口发送出去，但是被标记为不可达（度量值无穷大）。
    
- 计数到无穷大
    
    设置一个最大跳数，达到该跳数的路由被认为不可达。
    
- 触发更新（快速更新）
    
    如果一个度量变好或变坏，那么路由器将立即发送更新信息，而不等更新计时器超时。
    
- 抵制计时器

    如果到一个目标的距离增加，那么路由器将为该路由设置抵制计时器，直到计时器超时，路由器才可以接受有关此路由的更新信息。

- 异步更新
    
    在更新周期中加入随机时间或定时抖动作为偏移。
    
#### 链路状态路由选择协议

- 邻居
    
- 链路状态泛洪扩散

    - 序列号
    
    - 老化
    
- 链路状态数据库

- SPF 算法

- 区域	