<!--markdown--># IEEE以太网标准
## IEEE标准组织
### OSI模型中的IEEE子层

以太网标准与OSI模型的第1层（物理层）和第2层（数据链路层）相关，所以有人将以太网标准称为**链路层标准**.为了更好地组织以太网开发规范的细节，IEEE定义了匹配OSI模型第1层和第2层的额外子层，这意味着IEEE标准包含一些比OSI模型更详细的分层。

![主要的IEEE子层](https://raw.githubusercontent.com/zyywo/zyywo.pic/master/%E4%B8%BB%E8%A6%81%E7%9A%84IEE%E5%AD%90%E5%B1%82.png "主要的IEEE子层")

OSI数据链路层包括IEEE逻辑链路控制（LLC）和介质访问控制（MAC）子层。LLC层是IEEE定义的机制，基作用是识别以太网帧携带的数据。MAC层定义了用来随机访问以太网系统的协议。

OSI物理层包括标准化以太网介质速度的IEEE子层。这些子层用来协助组织以太网规范。

IEEE LLC标准独立于802.3以太网LAN标准，且不会因采用的LAN系统而变化。LLC控制领域不止面向以太网，还面向各种LAN系统，这也是LLC子层不属于IEE802.3系统规范的原因。

在LLC子层之下的各个IEEE子层都是面向特定LAN技术的，这里讨论的是面向以太网的。

## IEEE介质系统标识符

IEEE使用缩写标识符识别多种以太网介质系统。标识符分为三部分，分别表示**速度**、**信号类型**和**物理介质信息**。

### 10 Mbit/s介质系统 略

### 100 Mbit/s介质系统

- 100BASE-T

  这是IEEE对所有100Mbit/s系统的标识符。因为这个标识符既包括光纤系统也包括双绞线系统，所以此处的“-T”有些模棱两可。
  
- 100BASE-X

  这个标识符代表100BASE-TX介质系统和100BASE-FX介质系统。
  
- 100BASE-TX

  这个标准描述了一个在两对5类双绞线上运行的快速以太网系统。采用基带模式，速度为100Mbit/s
  
- 100BASE-FX

  这种快速以太网系统采用多模光纤电缆，基带模式。速度为100Mbit/s
  
### 1000 Mbit/s介质系统

- 1000BASE-X

  这个标识符描述了一个基于改自光纤通道的8B/10B块编码方案的千兆以太网介质系统。1000BASE-X介质系统包括1000BASE-SX、1000BASE-LX和1000BASE-CX。
  
- 1000BASE-SX

  这个标识符中的S代表短波长中的“短”。
  
- 1000BASE-LX

  这种千兆以太网采用长波长光纤介质段
  
- 1000BASE-T

  这是IEEE对采用5类（或更好的）双绞线的1000Mbit/s千兆以太网的标识符。
  
### 10 Gbit/s介质系统

- 10GBASE-CX4

  基于短程铜轴电缆（最长15米）的10Gbit/s以太网。
  
- 10GBASE-T

  基于无屏蔽和屏蔽双绞线电缆的10Gbit/s以太网。为了达到指定的最大距离，系统采用6A类或更好的双绞线。
  
- 10GBASE-SR

  基于短程多模光纤的10Gbit/s以太网
  
- 10GBASE-LR

  基于远程单模光纤电缆的10Gbit/s以太网。
  
### 40Gbit/s介质系统

- 40GBASE-CR4

  4个短程双轴铜电缆捆绑为一个单一电缆的40Gbit/s以太网。
  
- 40GBASE-SR4

  基于4个短程多模光纤电缆5 40Gbit/s以太网。
  
- 40GBASE-LR4

  基于一个长距离单模光纤电缆携带4个波长的40Gbit/s以太网。
  
### 100Gbit/s介质系统

- 100GBASE-SR10

- 100GBASE-LR4

2003年发布的10Gbit/s以太网标准，支持在扩展6类（CAT-6A）双绞电缆上进行每秒100亿位的传输。

# 以太网系统

最早期的以太网采用**半双工**操作模式。半双工是指在任意时间，只有一台计算机可以在以太网信道传递信息。在半双工模式下，多台计算机使用带有冲突检测的载波侦听多路访问（CSMA/CD）介质访问控制（MAC）协议共享单个以太网信道。

现今几乎所有以太网设备都直接连接到一个**全双工**模式以太网交换机接口上，不与其他设备共享以太网信道。当以太网设备连接到交换机端口时，自动协商协议会自动选择全双工模式，同时关闭CSMA/CD协议，使得链路中的两台设备都可以随时发送数据。

半双工模式和全双工模式是两种形式的介质访问控制。

## 以太网的四个基本元素

以太网系统包括四个基本块，这四块组合成一个正常运行的以太网。

- **帧**：系统中用来传递数据的一组标准化的数据位。

- **介质访问控制协议**：由一组嵌在各个以太网接口的协议组成，允许以太网基站通过半双工或全双工模式访问以太网信道。

- **信号组件**：可以在以太网信道发送或接收信号的标准化电子设备。

- **物理介质**：在联网的计算机间传递数字以太网信号的电缆或其他硬件。

### 以太网帧

一帧以一组64位的**帧头**开始。帧头给10Mbit/s以太网系统的硬件和电子设备一些启动时间来意识到有帧正在传输，提醒它们做好接收数据的准备。10Mbit/s网络正是通过这种方式清清嗓子，准备开唱的。较新的以太网系统运行速度更快，使用恒定信号，不再需要帧头。不过，为了避免帧结构改变，这些系统中的帧依旧保留了帧头。

帧头后是**目的地址**和**源地址**。每个地址都是独一无二的，这个48位的地址通常通常叫做硬件（物理）地址，以表明地址是分配给以太网接口的。这个地址也叫做介质访问控制（MAC）地址，这是因为以太网介质访问控制系统包括帧和帧的地址。

地址域之后是一个16位的**类型**或**长度**域。通常，这个域用来标识数据采用的是哪一种高级网络协议（如TCP/IP）。这个域也可能用来携带长度信息。

类型域之后便是长度为46到1500字节的**数据**。数据必须不短于46字节。这个长度保证帧信号在网络中停留的时间足以让最早的10Mbit/s半双工系统识别出来。

最后，在帧的末尾是32位的**帧校验序列**（FCS）域。FCS包括一个循环冗余检验（CRC），用来对整帧数据的完整性进行检测（除去帧头、起始帧分隔符、FCS的其他部分）。接收端以太网接口可以判断该帧各位是否完整传输。

### 介质访问控制协议

早期的以太网系统基于CSMA/CD协议，该协议用来对共享一个信道的基站进行访问动作管理。当今大部分基站采用的都是全双工模式，该模式为基站和交换机端口提供一个专用信道。

以太网传递机制支持多播，相较于将相同的帧传递给多个接收者，多播效率更高。通过一个多播地址，单个以太网帧可被多个基站接收。例如，一个提供流媒体服务的应用程序通过设置基站的以太网接口，使其不仅可以监听内置的单播地址，还可以监听指定的多播地址。这样，多个基站可以被配置为一个多播组。

# 以太网帧和全双工模式

现今大部分以太网链路都使用全双工模式，不过，使用双绞线10Mbit/s和100Mbit/s以太网接口仍旧支持半双工模式。

## 以太网帧

![以太网帧](https://raw.githubusercontent.com/zyywo/zyywo.pic/master/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E7%9A%84%E6%A0%BC%E5%BC%8F.png "以太网帧")

因为DIX基本帧和IEEE基本帧都至多有1518字节，并且拥有同样个数和长度的域，所以以太网接口既可以发送DIX基本帧，也可以发送IEEE基本帧。这些帧唯一不同之处在于内容域。

### 帧头

帧开头是64位的帧头域，帧头域的引入是为了帮助10Mbit/s以太网接口在实际内容到来之前同步数据流。考虑到信号在电缆系统传递存在启动延迟，帧头域允许若干字节的丢失。在10Mbit/s的系统上操作时，帧头域保护剩余帧的字节。

高速以太网系统采用更复杂的机制进行信号编码，以避免信号启动损失，因此这些系统也不需要帧头保护。不过，为了保证兼容早期以太网并为帧间管理提供时间，帧头部分仍然保留。

尽管两个标准对帧头位的官方定义略有不同，但DIX帧头和IEEE帧头在使用中是没有实质差异的，二者传递位的模式也是完全相同的。

- DIX标准

  帧头包括8个字节。帧头的前7字节由交替的0和1组成。第8字节的前6位是交替的0和1，末尾两位是统一的“1，1”。末尾两位提醒接口帧头已经结束，随后传来的将是帧的内容。

- IEE标准

  帧头域分为两个部分，第一部分是7字节的帧头，第二部分是1字节的起始帧分界符（SFD）。和DIX标准一样，SFD的最后两位是“1，1”。
  
### 目的地址

每个以太网接口都有一个独一无二的48位地址，叫作该接口的**物理地址**或**硬件地址**。目的地址域长48位，可以是目的基站的接口地址，也可以是多播地址或广播地址。

- DIX标准

  目的地址的第一位用于区分物理地址和多播地址。如果第一位为0，那么这个地址就是一个接口的物理地址，也叫单播地址。如果第一位为1，那么此帧将被发送到一个多播地址。如果48位都是1，那么这就是一个广播地址。
  
- IEEE标准

  IEEE 802.3标准对目的地址的第二位赋予了意义，利用其区分本地和全局管理地址。全局管理地址是制造商分配给网卡的物理地址，目的地址的第二位为0表示该地址为全局地址（DIX以太网地址都是全局管理地址）。如果因为某种原因，以太网接口是本地管理的，那么就要把目的地址的第二位设置为1。
  
  
  >因为在出厂时，每个以太网接口都配有以太网地址，所以本地管理地址很少见。
  
#### 理解物理地址

  以太网中，48位的物理地址由12个十六进制的数表示。这12个数两两为一组，每组8位信息。传送从最左的8位开始到最右的8位。一个字节中位的实际传送顺序是从最低位到最高位。
  
  也就量说，一个用十六进制字符串F0-2E-15-6C-77-9B表示的以太网地址在信道传递的字符串从左到右为：0000 1111 ... 1101 1001。
  
  因此，这个以十六进制0xF0开始的地址是单播地址，因为信道传送的第一位为0。
  
### 源地址

  源地址是发送设备的物理地址。尽管它是发送设备的唯一物理地址，但是以太网MAC协议不会解析此地址。高层网络协议会利用源地址来协助解决网络故障。交换机也会使用源地址创建表格，把源地址和交换机端口联系起来。以太网基站传送的所有帧都会将基站物理地址作为源地址。
  
### Q标签

  指802.1Q标签，这个标签也称为VLAN标签或者优先标签。指定VLAN的以太网流量只能被隶属于该VLAN的交换机端口发送或接收。
  
  Q标签的前两个字节是以太网类型标识符0x8100。如果一个不收发VLAN标签帧的以太网基站接收到了这种帧，该基站会把一个看上去像是类型标识符的东西看作一种未知的协议类型，并直接丢弃该帧。
  
### 信封前缀和后缀
  TODO
  
### 类型/长度域

- DIX标准

  DIX以太网标准定义的类型域长16位，其中包括一个标识符，用来指代以太网帧数据域携带的高层协议数据类型。例如，0x0800为IP协议的标识符。
  
- IEEE标准

  IEEE802.3将该域称为长度／类型域，域中的十六进制数值表示用何种规则使用该域。该域的第一个字节是最重要的数值。
  
  如果该域的数值小于或等于十进制数1500（十六进制0x5DC），那么这个域用作长度域。
  
  如果该域的数值大于或等于十进制数1536（十六进制0x600），那么这个域将用作类型域。
  
### 数据域
  TODO
  
### FCS域

  DIX帧和IEEE帧的最后一个域都是帧校验序列（FCS）域，也叫循环冗余检验（CRC）。
  
  接收基站接口在读取帧时会再次计算CRC，之后比较这个CRC值和帧FCS域的CRC值。如果两个值完全相同，说明信息传输过程无误，反之，网卡会丢弃该帧，同时帧错误计数器加一。
  
### 结束帧检测
  TODO

## 全双工介质访问控制

全双工操作必须满足以下要求
  
- 介质系统必须有可同步操作、独立收发数据的路径

- 任何全双工点对点链路都只连接两个基站。没有使用共享介质的连接，因此没有必要采用多路访问算法（如CSMA/CD）

- 基站和网络链路必须都支持并配置为全双工操作模式。	